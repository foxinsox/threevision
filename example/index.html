<head>
  <style>
    body {
      margin: 0;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r99/three.min.js"></script>
  <script src="../dist/threevision.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
</head>

<body>
  <div id="container"></div>

  <script>
    const mouse = new THREE.Vector3();
    let step = 0;

    // Setup renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    const rendererSize = new THREE.Vector2;
    renderer.getSize(rendererSize);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.getElementById('container').appendChild(renderer.domElement);


    // Prepare some sweet images by karen arnold
    const images = [];
    images.push("https://foxinsox.github.io/threevision/example/tropical-leaves-fruit-background_1024.jpg");
    images.push("https://foxinsox.github.io/threevision/example/bird-vintage-background-1547020715cla_1024.jpg");
    images.push("https://foxinsox.github.io/threevision/example/roses-background-vintage-wallpaper_1024.jpg");

    // Prepare some random colors
    const colors = [];
    const colorsCount = 10
    for (let i = 0; i < colorsCount; i++) {
      colors.push(new THREE.Color(`hsl(${i * 360 / colorsCount}, 75%, 50%)`));
    }

    // Lets create the textures from images and colors
    const materials = [];
    images.forEach((el) => {
      const texture = new THREE.TextureLoader().load(el);
      materials.push(new THREE.MeshBasicMaterial({ map: texture }));
    });
    colors.forEach((el) => {
      materials.push(new THREE.MeshBasicMaterial({ color: el }));
    });
    //and shuffle
    shuffle(materials);

    // Setup scene
    const scene = new THREE.Scene();
    scene.add(new THREE.AmbientLight(0xffffff));

    // Setup camera
    const camera = new THREE.PerspectiveCamera();
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    camera.lookAt(0, 0, 0);
    camera.position.z = 480;



    // Optional: Create a light and shadow layer
    var light = new THREE.SpotLight(0xcccccc);
    light.position.copy(camera.position);
    light.castShadow = true;            // default false
    light.shadow.mapSize.width = 4096;
    light.shadow.mapSize.height = 4096;
    light.shadow.camera.near = 0.5;       // default
    light.shadow.camera.far = 1000
    light.position.x -= 50;
    light.position.y += 40;
    scene.add(light);

    const planeGeometry = new THREE.PlaneBufferGeometry(innerWidth, innerHeight);
    const planeMaterial = new THREE.ShadowMaterial();
    planeMaterial.opacity = 0.05;
    // const planeMaterial = new THREE.MeshBasicMaterial({ color: new THREE.Color(0xbbbbbb) })
    const plane = new THREE.Mesh(planeGeometry, planeMaterial);
    plane.position.z = -50;
    plane.receiveShadow = true;
    scene.add(plane);



    // Create a threevision
    const threevision = new Threevision();
    threevision.materials = materials;
    threevision.width = window.innerWidth * 0.8;
    threevision.height = threevision.width; //sq
    threevision.prismCount = 10;
    threevision.speed = 10;
    threevision.mouseOverEffect = true;
    threevision.vertical = true;
    scene.add(threevision);

    // Kick-off renderer
    (function animate() { // IIFE
      // Frame cycle
      threevision.update(step, scene, camera, mouse);
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    })();

    function onMouseMove(event) {
      // calculate mouse position in normalized device coordinates
      // (-1 to +1) for both components
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
      mouse.z = 0;
    }

    function onMouseClicked(event) {
      step++;
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * i)
        const temp = array[i]
        array[i] = array[j]
        array[j] = temp
      }
      return array;
    }

    window.addEventListener('mousemove', onMouseMove, false);
    window.addEventListener('click', onMouseClicked, false);

  </script>
</body>